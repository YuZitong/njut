\documentclass[cs4size,a4paper,fancyhdr,fntef]{ctexbook}
\usepackage{amsmath,amsthm,amsfonts,amssymb,bm}
\usepackage{hyperref}
\usepackage[compress,numbers]{natbib}
\usepackage{graphicx}
\usepackage{graphicx}
\usepackage{geometry}
\usepackage{enumitem}
\usepackage{fancyvrb}
\usepackage{titletoc}
\usepackage{ulem}

\makeatletter

\hypersetup{CJKbookmarks,%
    bookmarksnumbered,%
        colorlinks,%
        linkcolor=black,%
        citecolor=black,%
        plainpages=false,%
        pdfstartview=FitH}
        
\geometry{top=3.5cm,bottom=3.5cm,left=3.2cm,right=3.2cm}
\geometry{headheight=2.6cm,headsep=3mm,footskip=13mm}

\parskip 0.5ex plus 0.25ex minus 0.25ex

\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
 \thispagestyle{empty}%
 \hbox{}\newpage\if@twocolumn\hbox{}\newpage\fi\fi\fi}

\renewcommand{\floatpagefraction}{0.80}
\newcommand\NJUTspace{\protect\CTEX@spaceChar\protect\CTEX@spaceChar}
\def\CTEX@contentsname{\zihao{3}\songti\bfseries 目\NJUTspace 录}
\def\CTEX@listfigurename{插\NJUTspace 图}
\def\CTEX@listtablename{表\NJUTspace 格}

%footnote
\fancypagestyle{plain}{%
    \fancyhf{}
    \fancyhead[C]{\if@mainmatter \small \leftmark\fi}
    \fancyfoot[C]{\small ~\thepage~}
    \renewcommand{\headrulewidth}{\if@mainmatter 0.7pt\else 0pt \fi}
}


%underline
\def\NJUT@underline[#1]#2{%
    \CTEXunderline{\hbox to #1{\hfill#2\hfill}}}
\def\NJUTunderline{\@ifnextchar[\NJUT@underline\CTEXunderline}



\def\NJUT@label@thesis{本~~科~~毕~~业~~论~~文}
\def\NJUT@label@title{题\CTEX@spaceChar\CTEX@spaceChar 目}
\def\NJUT@label@dept{院\CTEX@spaceChar\CTEX@spaceChar 系}
\def\NJUT@label@major{专\CTEX@spaceChar\CTEX@spaceChar 业}
\def\NJUT@label@author{学生姓名}
\def\NJUT@label@no{学\CTEX@spaceChar 号}
\def\NJUT@label@grade{年\CTEX@spaceChar\CTEX@spaceChar 级}
\def\NJUT@label@advisor{指导老师}
\def\NJUT@label@advisorp{职\CTEX@spaceChar 称}
\def\NJUT@label@date{论文提交日期}

%value
\def\NJUT@value@title{有限角度CT图像重建的优化}
\def\NJUT@value@author{郭夏玮}
\def\NJUT@value@advisor{袁杰}
\def\NJUT@value@advisorp{副教授}
\def\NJUT@value@major{电子}
\def\NJUT@value@department{电子科学与工程}
\def\NJUT@value@dept{电子科学与工程学院}
\def\NJUT@value@no{091180045}
\def\NJUT@value@grade{2009}
\def\NJUT@value@englishtitle{The optimization of limited angle Computerized Tomography Construction }
\def\NJUT@value@englishauthor{Xiawei Guo}
\def\NJUT@value@englishadvisor{Jie Yuan}
\def\NJUT@value@englishmajor{Electronic Information Science and Technology}
\def\NJUT@value@englishdepartment{Electronic Science and Engineering}
\def\NJUT@value@englishgrade{Xiawei Guo}
\def\NJUT@value@date{}

\renewcommand\maketitle{%
\thispagestyle{empty}
    \pdfbookmark[0]{NJU Cover}{cover}
    \begin{flushleft}
    \vskip 10mm
    \includegraphics[width=1.96cm]{figure/logo/njulogo}
    \end{flushleft}

    \begin{center}
    \includegraphics[height=2.5cm]{figure/logo/njuname} \\
    \vskip 15mm
    {\bfseries\songti\zihao{1} \NJUT@label@thesis}\\
    \vskip 5mm
    \vskip \stretch{1}
    \bfseries\mathbf\kaishu\zihao{3}
    \def\tabcolsep{1pt}
    \renewcommand\arraystretch{1.2}
    \renewcommand\ULthickness{1pt}
    \begin{tabular}{l}
    \NJUT@label@dept  \NJUTunderline[15em]{\NJUT@value@dept}\\
    \NJUT@label@major  \NJUTunderline[15em]{\NJUT@value@major}\\
    \NJUT@label@title  \NJUTunderline[15em]{\NJUT@value@title}\\
    \NJUT@label@grade  \NJUTunderline[6em]{\NJUT@value@grade}\NJUT@label@no\NJUTunderline[6em]{\NJUT@value@no}\\
    \NJUT@label@author  \NJUTunderline[15em]{\NJUT@value@author}\\
    \NJUT@label@advisor  \NJUTunderline[6em]{\NJUT@value@advisor}\NJUT@label@advisorp\NJUTunderline[6em]{\NJUT@value@advisorp}\\
    \NJUT@label@date \NJUTunderline[13em]{\NJUT@value@date}
    \end{tabular}\\
    \vskip \stretch{1}
    \end{center}
}




%abstract
\def\NJUT@abs@label@bar{南京大学本科生毕业论文（设计）中文摘要}
\def\NJUT@abs@label@englishbar{南京大学本科生毕业论文（设计）英文摘要}
\def\NJUT@abs@label@title{毕业论文题目：}
\def\NJUT@abs@label@major{专业}
\def\NJUT@abs@label@department{院系}
\def\NJUT@abs@label@author{级本科生姓名：}
\def\NJUT@abs@label@advisor{指导教师 （姓名、职称）:}
\def\NJUT@abs@label@abstract{摘要:}
\def\NJUT@abs@label@keywords{关键词}
\def\NJUT@abs@label@englishabstract{ABSTRACT:}
\def\NJUT@abs@label@englishkeywords{KEYWORDS:~}

\pagestyle{plain}

\newenvironment{abstract}{
    \pdfbookmark[0]{\NJUT@abs@label@abstract}{abstract}
    \begin{center}
        {\bf\kaishu\zihao{-2} \uuline{\NJUT@abs@label@bar}}
    \end{center}

    {\kaishu\zihao{4}%
        \noindent \NJUT@abs@label@title \NJUTunderline[22em]{\NJUT@value@title}

        \noindent \NJUTunderline[29em]{}

        \noindent \NJUTunderline[100pt]{\NJUT@value@department}\NJUT@abs@label@department%
        \NJUTunderline[45pt]{\NJUT@value@major}\NJUT@abs@label@major%
        \NJUTunderline[43pt]{\NJUT@value@grade}\NJUT@abs@label@author%
        \NJUTunderline[60pt]{\NJUT@value@author}

        \noindent \NJUT@abs@label@advisor \NJUTunderline[245pt]{\NJUT@value@advisor~~\NJUT@value@advisorp}

        \NJUT@abs@label@abstract

    }
}{}
\newcommand\keywords[1]{\vspace{2ex}\noindent{\kaishu \NJUT@abs@label@keywords} #1}

\newenvironment{englishabstract}{%
    \clearpage
    \begin{center}
        {\bf\kaishu\zihao{-2} \uuline{\NJUT@abs@label@englishbar}}
    \end{center}
    {\zihao{4}%
    \begin{description}[font=\normalfont,leftmargin=4em]
        \item[THESIS:]\NJUT@value@englishtitle
        \item[DEPARTMENT:]\NJUT@value@englishdepartment
        \item[SPECIALIZATION:]\NJUT@value@englishmajor
        \item[UNDERGRADUATE:]\NJUT@value@englishgrade
        \item[MENTOR:]\NJUT@value@englishadvisor
        \item[ABSTRACT:]\hfil
    \end{description}
    }
}{}
\newcommand\englishkeywords[1]{%
    \vspace{2ex}\noindent{\NJUT@abs@label@englishkeywords} #1}

%%
%contents
%%

\newcommand\NJUTtableofcontents{%
\cleardoublepage
\newpage
\@mainmattertrue
\addcontentsline{toc}{chapter}{目\NJUTspace 录}
\@mainmatterfalse
\tableofcontents
}


\addtocontents{toc}{\let\string\CTEX@spaceChar\relax}

\titlecontents{chapter}[2em]
              {\addvspace{0.6pc}\heiti\bfseries\zihao{4}}
              {\thecontentslabel\enspace}
              {}
              {\titlerule*[0.5em]{$\cdot$}\contentspage}
              [\addvspace{0.25pc}]

\titlecontents{section}[4em]
              {\addvspace{0.1pc}\songti\zihao{-4}}
              {\thecontentslabel\enspace}
              {}
              {\titlerule*[0.5em]{$\cdot$}\contentspage}
              [\addvspace{0.25pc}]

\titlecontents{subsection}[6em]
              {\addvspace{0.1pc}\songti\zihao{-4}}
              {\thecontentslabel\enspace}
              {}
              {\titlerule*[0.5em]{$\cdot$}\contentspage}
              [\addvspace{0.25pc}]

\newcommand\Nchapter[1]{%
    \if@mainmatter%
        \@mainmatterfalse%
        \chapter{#1}%
        \@mainmatterture%
    \else
        \chapter{#1}%
    \fi}
%bib
\renewcommand\bibfont{\zihao{-4}}
\def\CTEX@references{\zihao{1}参考}

%%section
\setcounter{secnumdepth}{4}
\def\CTEX@chapter@nameformat{\bfseries\heiti\zihao{4}}
\def\CTEX@chapter@titleformat{\bfseries\heiti\zihao{4}}
\def\CTEX@chapter@beforeskip{15\p@}
\def\CTEX@chapter@afterskip{12\p@}
\def\CTEX@section@format{\bfseries\heiti\zihao{4}\centering}
\def\CTEX@section@beforeskip{-3ex \@plus -1ex \@minus -.2ex}
\def\CTEX@section@afterskip{1.0ex \@plus .2ex}
\def\CTEX@subsection@format{\bfseries\heiti\zihao{-4}}
\def\CTEX@subsection@indent{2\ccwd}
\def\CTEX@subsection@beforeskip{-2.5ex \@plus -1ex \@minus -.2ex}
\def\CTEX@subsection@afterskip{1.0ex \@plus .2ex}
\def\CTEX@subsubsection@format{\bfseries\heiti\zihao{-4}}
\def\CTEX@subsubsection@indent{2\ccwd}
\def\CTEX@subsubsection@beforeskip{-2ex \@plus -1ex \@minus -.2ex}
\def\CTEX@subsubsection@afterskip{1.0ex \@plus .2ex}



\newtheoremstyle{break}% name
{}% Space above, empty = `usual value'
{}% Space below
{\itshape}% Body font
{}% Indent amount (empty = no indent, \parindent = para indent)
{\bfseries}% Thm head font
{.}% Punctuation after thm head
{\newline}% Space after thm head: \newline = linebreak
{}% Thm head spec


%%
%% the theorems definitions
%%
\theoremstyle{plain}
\newtheorem{algo}{算法~}[chapter]
\newtheorem{thm}{定理~}[chapter]
\newtheorem{lem}[thm]{引理~}
\newtheorem{prop}[thm]{命题~}
\newtheorem{cor}[thm]{推论~}
\theoremstyle{definition}
\newtheorem{defn}{定义~}[chapter]
\newtheorem{conj}{猜想~}[chapter]
\newtheorem{exmp}{例~}[chapter]
\newtheorem{rem}{注~}
\newtheorem{case}{情形~}
\theoremstyle{break}
\newtheorem{bthm}[thm]{定理~}
\newtheorem{blem}[thm]{引理~}
\newtheorem{bprop}[thm]{命题~}
\newtheorem{bcor}[thm]{推论~}
\renewcommand{\proofname}{{\bf 证明}}

\makeatother 